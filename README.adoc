

==== Environment Variables


. Set the following environment variables with values similar to the following:
+
-----
export RHSSO_HOST=sso.local
export RHSSO_URL=http://$RHSSO_HOST:4080
export RHSSO_MASTER_PASSWD=admin
export REALM_ID=ldap-demo
export OIDC_CLIENT_ID=minio-oidc
export OAUTH_CLIENT_ID=minio-oauth
export SSO_CLIENT_SECRET=avqeuje9yGOG37H1rbGm8I4qI7ht0ux1
export ACCESS_TOKEN_URL="$RHSSO_URL/realms/$REALM_ID/protocol/openid-connect/token"
export MINIO_ROUTE=http://localhost:9000
-----

. Add the following entry to your `/etc/hosts`:
+
-----
127.0.0.1   sso.local
-----

. Retrieve an OAuth2 _access token_ using OAuth2 [Client Credentials] flow :
+
-----
TKN=$(curl -X POST "$ACCESS_TOKEN_URL" \
            -H "Content-Type: application/x-www-form-urlencoded" \
            -d "client_id=$OAUTH_CLIENT_ID" \
            -d "client_secret=$SSO_CLIENT_SECRET" \
            -d "grant_type=client_credentials" \
            -d "scope=openid" \
            | sed 's/.*access_token":"//g' | sed 's/".*//g')

$ echo $TKN
-----
+
NOTE:  By setting a `scope=openid`, the OIDC _id_token_ is also included in the response.

. Value of _policy_ claim can be viewed as follows .

. Retrieve an OAuth2 _access token_ using OAuth2 link:https://tools.ietf.org/html/rfc6749#section-4.3[Resource Owner Password Credentials] flow :
+
-----
TKN=$(curl -X POST "$ACCESS_TOKEN_URL" \
            -H "Content-Type: application/x-www-form-urlencoded" \
            -d "username=minioAdmin" \
            -d "password=minio" \
            -d "grant_type=password" \
            -d "client_id=$OIDC_CLIENT_ID" \
            -d "client_secret=$SSO_CLIENT_SECRET" \
            -d "scope=openid" \
            | sed 's/.*access_token":"//g' | sed 's/".*//g')

$ echo $TKN
-----
+
NOTE:  By setting a `scope=openid`, the OIDC _id_token_ is also included in the response.

. Value of _policy_ claim can be viewed as follows .
+
-----
$ jq -R 'split(".") | .[1] | @base64d | fromjson' <<< $TKN | jq -r .policy

consoleAdmin
-----

-----
curl -X POST "$MINIO_ROUTE" \
            -H "Content-Type: application/x-www-form-urlencoded" \
            -d "Action=AssumeRoleWithWebIdentity" \
            -d "WebIdentityToken=$TKN" \
            -d "Version=2011-06-15" \
            -d "DurationSeconds=86000"
-----
